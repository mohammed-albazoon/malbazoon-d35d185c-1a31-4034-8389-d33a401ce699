# Render Blueprint - deploys both backend and frontend
services:
  # Backend API
  - type: web
    name: task-management-api
    env: node
    region: oregon
    plan: free
    buildCommand: NODE_ENV=development npm install && NODE_ENV=production npx nx build api --configuration=production
    startCommand: node dist/apps/api/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        generateValue: true
      - key: DATABASE_PATH
        value: /opt/render/project/src/data/task-management.db
      - key: PORT
        value: 3000
      - key: CORS_ORIGIN
        value: https://task-management-dashboard-83jv.onrender.com

  # Frontend Dashboard
  - type: web
    name: task-management-dashboard
    env: static
    region: oregon
    plan: free
    buildCommand: NODE_ENV=development npm install && NODE_ENV=production npx nx build dashboard --configuration=production
    staticPublishPath: dist/apps/dashboard/browser
    headers:
      - path: /*
        name: Cache-Control
        value: no-cache
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
